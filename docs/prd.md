# PRD (Product Requirements Document)
# 폴링 기반 채팅 애플리케이션

---

## 1. 제품 개요

### 1.1 제품 설명
사용자 인증을 통과한 사용자들에게 끊김 없는 채팅 경험을 제공하는 웹 애플리케이션이다. Flux 기반 데이터 흐름과 Context API를 활용하여 상태를 예측 가능하게 관리하며, 폴링 방식으로 메시지를 실시간 동기화한다.

### 1.2 제품 비전
- 유지보수가 용이한 레이어드 아키텍처 구현
- 예측 가능한 상태 관리를 통한 안정적인 사용자 경험 제공
- 확장 가능한 채팅 서비스 기반 구축

### 1.3 프로젝트 범위
- **포함**: 인증, 채팅방 관리, 메시지 송수신, 리액션, 북마크 기능
- **제외**: 파일/이미지 업로드, 음성/영상 통화, 1:1 다이렉트 메시지

---

## 2. Stakeholders

| 역할 | 책임 | 관심사 |
|------|------|--------|
| **프로덕트 오너** | 요구사항 정의, 우선순위 결정 | 사용자 가치, 비즈니스 목표 |
| **개발팀** | 설계 및 구현, 테스트 | 기술적 실현 가능성, 코드 품질 |
| **QA 팀** | 품질 검증, 버그 리포팅 | 안정성, 사용성 |
| **최종 사용자** | 서비스 이용 | 사용 편의성, 응답 속도 |
| **운영팀** | 배포, 모니터링 | 시스템 안정성, 장애 대응 |

---

## 3. 목표 및 성공 지표

### 3.1 비즈니스 목표
1. 안정적인 실시간 채팅 서비스 제공
2. 확장 가능한 아키텍처 기반 마련
3. 사용자 참여도 향상

### 3.2 성공 지표 (KPI)

| 지표 | 목표값 | 측정 방법 |
|------|--------|-----------|
| 메시지 전송 성공률 | 99.5% 이상 | 서버 로그 분석 |
| 메시지 동기화 지연 | 5초 이내 | 폴링 주기 기준 |
| 페이지 로드 시간 | 3초 이내 | Lighthouse 측정 |
| 서버 응답 시간 | 200ms 이내 | API 모니터링 |
| 동시 접속자 처리 | 1,000명 이상 | 부하 테스트 |

---

## 4. 타겟 사용자

### 4.1 사용자 세그먼트

#### Primary: 일반 커뮤니티 사용자
- **특성**: 텍스트 기반 소통을 선호하는 사용자
- **니즈**: 간편한 가입, 빠른 메시지 송수신, 관심 메시지 저장
- **페인 포인트**: 복잡한 인터페이스, 느린 응답 속도

#### Secondary: 방장/모더레이터
- **특성**: 채팅방을 개설하고 관리하는 사용자
- **니즈**: 방 설정 관리, 참여자 현황 파악
- **페인 포인트**: 관리 도구 부족, 설정 변경의 어려움

### 4.2 사용자 페르소나

**페르소나 1: 김민수 (28세, 회사원)**
- 점심시간에 관심사 기반 채팅방에서 대화
- 모바일과 데스크톱을 번갈아 사용
- 중요한 정보는 북마크로 저장

**페르소나 2: 이지영 (32세, 프리랜서)**
- 특정 주제의 채팅방을 개설하여 운영
- 활발한 토론을 유도하고 싶어함
- 방 설정을 자주 수정

---

## 5. 사용자 여정 (User Journey)

### 5.1 신규 사용자 온보딩

```
[랜딩 페이지] → [회원가입 페이지] → [이메일 입력/비밀번호 설정]
    → [가입 완료] → [채팅방 목록 페이지] → [첫 채팅방 참여]
```

| 단계 | 사용자 세그먼트 | 페이지 | 행동 | 감정 |
|------|----------------|--------|------|------|
| 1 | 일반 사용자 | 랜딩 페이지 (`/`) | 서비스 확인 | 호기심 |
| 2 | 일반 사용자 | 회원가입 (`/signup`) | 계정 생성 | 기대 |
| 3 | 일반 사용자 | 로그인 (`/login`) | 로그인 수행 | 설렘 |
| 4 | 일반 사용자 | 채팅방 목록 (`/rooms`) | 방 탐색 | 탐색 |
| 5 | 일반 사용자 | 채팅방 상세 (`/rooms/[roomId]`) | 대화 참여 | 만족 |

### 5.2 기존 사용자 일반 플로우

```
[로그인 페이지] → [채팅방 목록] → [채팅방 입장] → [메시지 작성/읽기]
    → [리액션/북마크] → [로그아웃]
```

| 단계 | 사용자 세그먼트 | 페이지 | 행동 | 감정 |
|------|----------------|--------|------|------|
| 1 | 일반 사용자 | 로그인 (`/login`) | 인증 | 일상적 |
| 2 | 일반 사용자 | 채팅방 목록 (`/rooms`) | 최근 방 선택 | 편안함 |
| 3 | 일반 사용자 | 채팅방 상세 (`/rooms/[roomId]`) | 메시지 확인/작성 | 집중 |
| 4 | 일반 사용자 | 채팅방 상세 (`/rooms/[roomId]`) | 좋아요, 북마크 | 참여감 |
| 5 | 일반 사용자 | 북마크 목록 (`/bookmarks`) | 저장 메시지 확인 | 만족 |

### 5.3 채팅방 개설 플로우

```
[채팅방 목록] → [방 만들기 버튼] → [방 정보 입력 모달/페이지]
    → [생성 완료] → [새 채팅방 입장]
```

| 단계 | 사용자 세그먼트 | 페이지 | 행동 | 감정 |
|------|----------------|--------|------|------|
| 1 | 방장/모더레이터 | 채팅방 목록 (`/rooms`) | 방 만들기 클릭 | 의욕 |
| 2 | 방장/모더레이터 | 방 생성 모달 | 이름, 설명, 공개 범위 설정 | 기대 |
| 3 | 방장/모더레이터 | 채팅방 상세 (`/rooms/[roomId]`) | 새 방에서 대화 시작 | 성취감 |

---

## 6. 포함 페이지

### 6.1 페이지 목록

| 페이지 | 경로 | 설명 | 인증 필요 |
|--------|------|------|-----------|
| 랜딩 페이지 | `/` | 서비스 소개, 로그인/가입 진입점 | X |
| 로그인 | `/login` | 이메일/비밀번호 로그인 | X |
| 회원가입 | `/signup` | 신규 계정 생성 | X |
| 채팅방 목록 | `/rooms` | 전체 방 목록, 검색, 방 생성 | O |
| 채팅방 상세 | `/rooms/[roomId]` | 메시지 목록, 입력, 리액션, 북마크 | O |
| 북마크 목록 | `/bookmarks` | 북마크한 메시지 모아보기 | O |

### 6.2 페이지별 주요 기능

#### 로그인 페이지 (`/login`)
- 이메일/비밀번호 입력 폼
- 로그인 버튼
- 회원가입 페이지 링크
- 에러 메시지 표시

#### 회원가입 페이지 (`/signup`)
- 이메일/비밀번호/비밀번호 확인 입력 폼
- 가입 버튼
- 로그인 페이지 링크
- 유효성 검사 및 에러 표시

#### 채팅방 목록 페이지 (`/rooms`)
- 채팅방 카드 목록 (방 이름, 설명, 참여자 수)
- 방 검색 기능
- 방 만들기 버튼/모달
- 방 클릭 시 상세 페이지 이동

#### 채팅방 상세 페이지 (`/rooms/[roomId]`)
- 방 정보 헤더 (이름, 설명)
- 메시지 목록 (스크롤, 폴링 자동 갱신)
- 메시지 입력창 (텍스트 + 이모지)
- 메시지별 좋아요 버튼 및 카운트
- 메시지별 북마크 버튼
- 본인 메시지 삭제 버튼

#### 북마크 목록 페이지 (`/bookmarks`)
- 북마크한 메시지 목록
- 원본 메시지로 이동 링크
- 북마크 해제 버튼

---

## 7. 정보 구조 (IA - Information Architecture)

```
[애플리케이션]
├── (Public)
│   ├── / (랜딩 페이지)
│   │   └── 서비스 소개
│   │   └── 로그인/가입 버튼
│   │
│   ├── /login (로그인)
│   │   └── 로그인 폼
│   │   └── 회원가입 링크
│   │
│   └── /signup (회원가입)
│       └── 가입 폼
│       └── 로그인 링크
│
├── (Authenticated)
│   ├── /rooms (채팅방 목록)
│   │   ├── 채팅방 카드 목록
│   │   │   └── RoomCard (방 이름, 설명, 참여자 수)
│   │   ├── 검색 바
│   │   └── 방 만들기
│   │       └── CreateRoomForm (이름, 설명, 공개 범위)
│   │
│   ├── /rooms/[roomId] (채팅방 상세)
│   │   ├── 방 정보 헤더
│   │   ├── MessageList (메시지 목록)
│   │   │   └── MessageItem
│   │   │       ├── 메시지 내용
│   │   │       ├── 좋아요 버튼 + 카운트
│   │   │       ├── 북마크 버튼
│   │   │       └── 삭제 버튼 (본인만)
│   │   └── MessageInput (메시지 입력)
│   │       ├── 텍스트 입력
│   │       └── 이모지 선택
│   │
│   └── /bookmarks (북마크 목록)
│       └── BookmarkList
│           └── BookmarkItem
│               ├── 메시지 내용 미리보기
│               ├── 원본 이동 링크
│               └── 북마크 해제
│
└── [공통 레이아웃]
    ├── Header
    │   ├── 로고
    │   ├── 네비게이션 (채팅방, 북마크)
    │   └── 사용자 메뉴 (로그아웃)
    └── Sidebar (선택적)
        └── 최근 방 목록
```

---

## 8. 핵심 기능 및 요구사항

### 8.1 기능적 요구사항

#### FR-001: 회원가입
| 항목 | 내용 |
|------|------|
| 설명 | 사용자가 이메일과 비밀번호로 계정을 생성한다 |
| 우선순위 | P0 (필수) |
| 입력 | 이메일, 비밀번호, 비밀번호 확인 |
| 처리 | 이메일 형식 검증, 비밀번호 일치 확인, Supabase Auth 연동 |
| 출력 | 가입 성공 시 로그인 페이지 이동, 실패 시 에러 메시지 |
| 인수 조건 | 유효한 이메일과 비밀번호로 계정 생성 가능 |

#### FR-002: 로그인
| 항목 | 내용 |
|------|------|
| 설명 | 인증된 사용자만 애플리케이션에 접근한다 |
| 우선순위 | P0 (필수) |
| 입력 | 이메일, 비밀번호 |
| 처리 | Supabase Auth 인증, 세션 생성 |
| 출력 | 성공 시 채팅방 목록 이동, 실패 시 에러 메시지 |
| 인수 조건 | 올바른 자격증명으로 로그인 가능, 세션 유지 |

#### FR-003: 로그아웃
| 항목 | 내용 |
|------|------|
| 설명 | 사용자가 세션을 종료한다 |
| 우선순위 | P0 (필수) |
| 입력 | 로그아웃 버튼 클릭 |
| 처리 | 세션 삭제, Context 상태 초기화 |
| 출력 | 랜딩/로그인 페이지 이동 |
| 인수 조건 | 로그아웃 후 인증 필요 페이지 접근 불가 |

#### FR-004: 채팅방 개설
| 항목 | 내용 |
|------|------|
| 설명 | 사용자가 새로운 채팅방을 생성한다 |
| 우선순위 | P0 (필수) |
| 입력 | 방 이름, 설명(선택), 공개 범위 |
| 처리 | 입력 검증, DB 저장, 방 생성자를 참여자로 등록 |
| 출력 | 생성된 채팅방 상세 페이지 이동 |
| 인수 조건 | 유효한 입력으로 방 생성 가능, 생성자 자동 참여 |

#### FR-005: 채팅방 목록 조회
| 항목 | 내용 |
|------|------|
| 설명 | 전체 공개 채팅방 목록을 확인한다 |
| 우선순위 | P0 (필수) |
| 입력 | 페이지 접근, 검색어(선택) |
| 처리 | 공개 방 목록 조회, 검색 필터링 |
| 출력 | 채팅방 카드 목록 표시 |
| 인수 조건 | 공개 방 목록 표시, 검색 기능 동작 |

#### FR-006: 채팅방 참여
| 항목 | 내용 |
|------|------|
| 설명 | 사용자가 원하는 채팅방에 합류한다 |
| 우선순위 | P0 (필수) |
| 입력 | 방 카드 클릭 |
| 처리 | 참여자 등록(신규인 경우), 방 상세 페이지 이동 |
| 출력 | 채팅방 상세 페이지 표시 |
| 인수 조건 | 방 클릭 시 참여 및 페이지 이동 |

#### FR-007: 메시지 송신
| 항목 | 내용 |
|------|------|
| 설명 | 텍스트와 이모지를 조합한 메시지를 작성한다 |
| 우선순위 | P0 (필수) |
| 입력 | 메시지 텍스트, 이모지(선택) |
| 처리 | 입력 검증, Hono API 전송, Supabase 저장 |
| 출력 | 메시지 목록에 새 메시지 표시 |
| 인수 조건 | 텍스트/이모지 조합 메시지 전송 가능 |

#### FR-008: 메시지 수신 (폴링)
| 항목 | 내용 |
|------|------|
| 설명 | 주기적 폴링으로 새 메시지를 동기화한다 |
| 우선순위 | P0 (필수) |
| 입력 | 자동 폴링 (3초 주기) |
| 처리 | 마지막 메시지 이후 새 메시지 조회 |
| 출력 | 메시지 목록 자동 갱신 |
| 인수 조건 | 다른 사용자 메시지가 5초 이내 표시 |

#### FR-009: 좋아요 (리액션)
| 항목 | 내용 |
|------|------|
| 설명 | 메시지에 좋아요를 표시한다 |
| 우선순위 | P1 (중요) |
| 입력 | 좋아요 버튼 클릭 |
| 처리 | 리액션 토글, 집계 수 업데이트 |
| 출력 | 좋아요 아이콘 상태 변경, 카운트 표시 |
| 인수 조건 | 좋아요 추가/취소 가능, 집계 수 실시간 반영 |

#### FR-010: 북마크
| 항목 | 내용 |
|------|------|
| 설명 | 관심 메시지를 북마크하여 저장한다 |
| 우선순위 | P1 (중요) |
| 입력 | 북마크 버튼 클릭 |
| 처리 | 북마크 토글, 북마크 목록에 추가/제거 |
| 출력 | 북마크 아이콘 상태 변경 |
| 인수 조건 | 북마크 추가/해제 가능, 별도 페이지에서 모아보기 |

#### FR-011: 본인 메시지 삭제
| 항목 | 내용 |
|------|------|
| 설명 | 본인이 작성한 메시지를 삭제한다 |
| 우선순위 | P1 (중요) |
| 입력 | 삭제 버튼 클릭 (본인 메시지만 표시) |
| 처리 | 권한 검증, 메시지 삭제 |
| 출력 | 메시지 목록에서 제거 |
| 인수 조건 | 본인 메시지만 삭제 가능, 삭제 후 다른 사용자에게 미노출 |

---

## 9. 기술적 요구사항

### 9.1 기술 스택

| 구분 | 기술 | 버전 |
|------|------|------|
| Frontend | Next.js App Router | 15.x 또는 16.x |
| Runtime | Node.js | 22 LTS (최소 20.9) |
| State Management | Flux + Context API | - |
| Server | Hono + @hono/vercel | 최신 |
| BaaS | Supabase | SDK v2.x |
| Database | PostgreSQL | Supabase 관리 |
| Auth | Supabase Auth | - |
| Deployment | Vercel | - |

### 9.2 아키텍처 요구사항

#### 레이어드 아키텍처
```
Presentation Layer (Components, Pages)
         ↓
Server Layer (Hono Routes, Handlers, Middleware)
         ↓
Business Logic Layer (Services, Validators)
         ↓
Data Access Layer (Repositories)
         ↓
External Integration Layer (Supabase)
```

#### 데이터 흐름
- **클라이언트 → 서버**: React → `/api/*` (Hono) → Supabase
- **서버 → 클라이언트**: Supabase → Hono → React (폴링 응답)
- **상태 관리**: Action → Dispatcher → Store → View (Flux)

### 9.3 API 설계

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/auth/signup` | 회원가입 |
| POST | `/api/auth/login` | 로그인 |
| POST | `/api/auth/logout` | 로그아웃 |
| GET | `/api/rooms` | 채팅방 목록 조회 |
| POST | `/api/rooms` | 채팅방 생성 |
| GET | `/api/rooms/[roomId]` | 채팅방 상세 조회 |
| GET | `/api/rooms/[roomId]/messages` | 메시지 목록 조회 (폴링) |
| POST | `/api/rooms/[roomId]/messages` | 메시지 전송 |
| DELETE | `/api/messages/[messageId]` | 메시지 삭제 |
| POST | `/api/messages/[messageId]/reactions` | 리액션 추가 |
| DELETE | `/api/messages/[messageId]/reactions` | 리액션 삭제 |
| GET | `/api/bookmarks` | 북마크 목록 조회 |
| POST | `/api/bookmarks` | 북마크 추가 |
| DELETE | `/api/bookmarks/[bookmarkId]` | 북마크 삭제 |

---

## 10. 비기능적 요구사항

### 10.1 성능 (Performance)

| 항목 | 요구사항 | 측정 방법 |
|------|----------|-----------|
| 페이지 초기 로드 | 3초 이내 (FCP) | Lighthouse |
| API 응답 시간 | 200ms 이내 (P95) | 서버 모니터링 |
| 메시지 동기화 지연 | 5초 이내 | 폴링 주기 |
| 클라이언트 메모리 | 100MB 이내 | DevTools |
| 번들 크기 | 500KB 이내 (gzipped) | 빌드 분석 |

### 10.2 보안 (Security)

| 항목 | 요구사항 |
|------|----------|
| 인증 | Supabase Auth 기반 세션 관리 |
| 권한 제어 | Hono 미들웨어에서 모든 접근 제어 처리 |
| 키 관리 | Service Role Key는 서버 환경 변수에만 저장 |
| 입력 검증 | 모든 입력은 Hono 순수 함수로 검증/정규화 |
| RLS | 비활성화 (Hono 계층이 접근 제어 담당) |
| HTTPS | 모든 통신 암호화 (Vercel 기본 제공) |

### 10.3 확장성 (Scalability)

| 항목 | 요구사항 |
|------|----------|
| 동시 접속자 | 1,000명 이상 처리 가능 |
| 메시지 처리량 | 초당 1,000건 이상 |
| 서버리스 | Vercel Serverless Functions 활용 |
| 데이터베이스 | Supabase 자동 스케일링 |

### 10.4 가용성 (Availability)

| 항목 | 요구사항 |
|------|----------|
| 업타임 | 99.9% 이상 |
| 장애 복구 | 자동 재시작 (Vercel) |
| 데이터 백업 | Supabase 자동 백업 |

### 10.5 유지보수성 (Maintainability)

| 항목 | 요구사항 |
|------|----------|
| 코드 품질 | 함수형 프로그래밍 원칙 준수 |
| 테스트 | TDD 프로세스 준수, 70% 이상 커버리지 |
| 문서화 | 코드 주석, API 문서 |
| 로깅 | 감사 로깅 (Hono 미들웨어) |

---

## 11. 제약사항 및 가정

### 11.1 제약사항

| 구분 | 내용 |
|------|------|
| 기술 | Next.js App Router 사용 필수 |
| 기술 | Supabase를 BaaS로 사용 |
| 기술 | Realtime 대신 폴링 방식 사용 |
| 보안 | RLS 비활성화, Hono에서 접근 제어 |
| 배포 | Vercel 플랫폼 전용 |
| 브라우저 | 최신 Chrome, Firefox, Safari, Edge 지원 |

### 11.2 가정

| 구분 | 내용 |
|------|------|
| 인프라 | Supabase와 Vercel 서비스 안정성 유지 |
| 네트워크 | 사용자는 안정적인 인터넷 연결 보유 |
| 사용 패턴 | 동시 접속자 1,000명 이내 (초기) |
| 메시지 크기 | 단일 메시지 최대 2,000자 |
| 폴링 주기 | 3초가 사용자 경험에 적합 |

---

## 12. 용어 정의

| 용어 | 정의 |
|------|------|
| **Flux** | Facebook이 개발한 단방향 데이터 흐름 아키텍처 패턴 (Action → Dispatcher → Store → View) |
| **Context API** | React의 전역 상태 관리 기능 |
| **폴링 (Polling)** | 주기적으로 서버에 데이터를 요청하여 최신 상태를 동기화하는 방식 |
| **Hono** | 경량 웹 프레임워크, Vercel Serverless Functions에서 실행 |
| **Supabase** | PostgreSQL 기반 오픈소스 Backend-as-a-Service |
| **RLS (Row Level Security)** | PostgreSQL의 행 단위 접근 제어 기능 |
| **Service Role Key** | Supabase의 고권한 서버 전용 API 키 |
| **리액션 (Reaction)** | 메시지에 대한 좋아요 등의 반응 표시 |
| **북마크 (Bookmark)** | 관심 메시지를 저장하여 나중에 참조하는 기능 |
| **레이어드 아키텍처** | 관심사 분리 원칙에 따라 계층화된 소프트웨어 구조 |

---

## 13. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0 | 2025-11-23 | - | 최초 작성 |

---

## 14. 승인

| 역할 | 이름 | 서명 | 날짜 |
|------|------|------|------|
| 프로덕트 오너 | | | |
| 기술 리드 | | | |
| QA 리드 | | | |
